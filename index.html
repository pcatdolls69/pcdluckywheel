<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PCD Lucky Wheel</title>
<style>
Â Â :root{
Â Â Â Â --brand:#6e2b74;Â Â Â Â Â Â /* ä¸»ç´« */
Â Â Â Â --ring:#eadcf3;Â Â Â Â Â Â Â /* å¤–åœˆ */
Â Â Â Â --card:#ffffff;
Â Â Â Â --bg1:#fbf1ff;
Â Â Â Â --shadow:0 8px 30px rgba(0,0,0,.08);
Â Â Â Â --text:#2b2b2b;
Â Â Â Â --muted:#7d7d7d;
Â Â }
Â Â *{box-sizing:border-box}
Â Â html,body{height:100%;margin:0}
Â Â body{
Â Â Â Â display:flex;align-items:center;justify-content:center;min-height:100vh;
Â Â Â Â background:radial-gradient(1200px 600px at 50% -200px,var(--bg1),#fff);
Â Â Â Â font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,PingFang SC, Hiragino Sans GB, Microsoft YaHei, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol;
Â Â Â Â color:var(--text);
Â Â }
Â Â .card{
Â Â Â Â width:min(680px,96vw);
Â Â Â Â background:var(--card);border-radius:28px;padding:22px 20px 26px;
Â Â Â Â box-shadow:var(--shadow);
Â Â }
Â Â .stage{
Â Â Â Â position:relative;background:#fff;border-radius:22px;padding:18px;
Â Â Â Â box-shadow:inset 0 0 0 2px #f2e9f7;
Â Â }
Â Â .wheelWrap{position:relative;width:100%;aspect-ratio:1/1}
Â Â canvas{
Â Â Â Â width:100%;height:100%;display:block;border-radius:50%;
Â Â Â Â box-shadow:inset 0 0 0 14px var(--ring), inset 0 0 0 3px #fff;
Â Â Â Â background:#fff;
Â Â }
Â Â /* ä¸­å¤®æŒ‡é‡ï¼ˆç™½åœ“ï¼‹ç´«è‰²å°ä¸‰è§’æœä¸Šï¼‰ */
Â Â .center-pointer{
Â Â Â Â position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
Â Â Â Â width:22%;aspect-ratio:1/1;border-radius:50%;
Â Â Â Â background:radial-gradient(circle at 50% 50%, #fff 35%, #ffffff 36%, var(--brand) 36%, var(--brand) 100%);
Â Â Â Â display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 6px 10px rgba(0,0,0,.12));
Â Â }
Â Â .center-pointer:before{
Â Â Â Â content:"";width:0;height:0;position:absolute;top:6.5%;
Â Â Â Â left:50%;transform:translate(-50%,-50%);
Â Â Â Â border-left:12px solid transparent;border-right:12px solid transparent;
Â Â Â Â border-bottom:18px solid var(--brand);
Â Â }

Â Â .actions{display:flex;gap:14px;justify-content:center;margin:18px 0 8px}
Â Â .btn{
Â Â Â Â padding:14px 24px;border-radius:18px;border:0;cursor:pointer;
Â Â Â Â background:linear-gradient(180deg,#f7d1ff,#ffc2c2);
Â Â Â Â color:#632d79;font-weight:700;font-size:20px;box-shadow:var(--shadow);
Â Â }
Â Â .btn:disabled{opacity:.6;cursor:not-allowed}

Â Â .topRow{
Â Â Â Â display:flex;align-items:center;justify-content:center;gap:14px;
Â Â Â Â margin:10px 0 0;
Â Â Â Â color:#866; font-weight:600;
Â Â }
Â Â .remain{
Â Â Â Â background:#fff;border-radius:12px;padding:8px 12px;box-shadow:var(--shadow);
Â Â Â Â font-size:14px;color:#5a5a5a;
Â Â }

Â Â .chipRow{display:flex;gap:14px;justify-content:center;margin:8px 0 10px}
Â Â .chip{
Â Â Â Â display:flex;align-items:center;gap:10px;border-radius:16px;padding:12px 16px;
Â Â Â Â background:#fff;box-shadow:var(--shadow);color:#3b3b3b;font-weight:600;border:0;cursor:pointer;
Â Â }
Â Â .chip .dot{font-size:20px}

Â Â .muted{color:var(--muted);text-align:center;font-size:14px;line-height:1.6}
Â Â .rule{margin-top:6px}
Â Â .status{margin-top:8px}
</style>
</head>
<body>
Â Â <div class="card">
Â Â Â Â <div class="stage">
Â Â Â Â Â Â <div class="wheelWrap">
Â Â Â Â Â Â Â Â <canvas id="wheel"></canvas>
Â Â Â Â Â Â Â Â <div class="center-pointer" aria-hidden="true"></div>
Â Â Â Â Â Â </div>
Â Â Â Â </div>

Â Â Â Â <div class="topRow">
Â Â Â Â Â Â <div id="remaining" class="remain">--</div>
Â Â Â Â </div>

Â Â Â Â <div class="actions">
Â Â Â Â Â Â <button id="startBtn" class="btn">å¼€å§‹ / Start</button>
Â Â Â Â </div>

Â Â Â Â <div class="chipRow">
Â Â Â Â Â Â <button id="subBtn" class="chip"><span class="dot">âœ…</span><span id="t_sub">è®¢é˜… PCD / Subscribe PCD</span></button>
Â Â Â Â Â Â <button id="shareBtn" class="chip"><span class="dot">ğŸ”—</span><span id="t_share">åˆ†äº« / Share</span></button>
Â Â Â Â </div>

Â Â Â Â <div class="muted rule" id="ruleText">
Â Â Â Â Â Â ğŸŒŸ æ¯ 3 å¤© 1 æ¬¡ï¼›å®Œæˆ è®¢é˜… + åˆ†äº« å† +1ï¼›æŠ½åˆ° ğŸ å† +1<br/>
Â Â Â Â Â Â (Every 3 days 1 spin; +1 after subscribing + sharing; +1 on ğŸ one more chance)
Â Â Â Â </div>
Â Â Â Â <div id="status" class="muted status"></div>
Â Â </div>

<script>
(() => {
Â Â /************ i18n ************/
Â Â const tg = window.Telegram?.WebApp || null;
Â Â const langGuess =
Â Â Â Â tg?.initDataUnsafe?.user?.language_code ||
Â Â Â Â navigator.language || "en";
Â Â const isCN = /^zh/i.test(langGuess);

Â Â const T = isCN ? {
Â Â Â Â start: "å¼€å§‹ / Start",
Â Â Â Â sub: "è®¢é˜… PCD / Subscribe PCD",
Â Â Â Â share: "åˆ†äº« / Share",
Â Â Â Â rule: "ğŸŒŸ æ¯ 3 å¤© 1 æ¬¡ï¼›å®Œæˆ è®¢é˜… + åˆ†äº« å† +1ï¼›æŠ½åˆ° ğŸ å† +1<br/>(Every 3 days 1 spin; +1 after subscribing + sharing; +1 on ğŸ one more chance)",
Â Â Â Â remain: (r,p) => `å‰©é¤˜æ¬¡æ•¸ï¼š${r}ï¼ˆé€±æœŸï¼šæ¯ ${p} å¤©ï¼‰`,
Â Â Â Â usedOut: "æœ¬æœŸå·²ç”¨å®Œ / Allowance used up",
Â Â Â Â congrats: "ğŸ‰ æ­å–œä¸­å¥–ï¼\n\n",
Â Â } : {
Â Â Â Â start: "Start",
Â Â Â Â sub: "Subscribe PCD",
Â Â Â Â share: "Share",
Â Â Â Â rule: "ğŸŒŸ Every 3 days 1 spin; +1 after subscribing + sharing; +1 on ğŸ one more chance",
Â Â Â Â remain: (r,p) => `Remaining: ${r} (period: ${p} days)`,
Â Â Â Â usedOut: "Allowance used up",
Â Â Â Â congrats: "ğŸ‰ Congratulations!\n\n",
Â Â };

Â Â document.getElementById("startBtn").textContent = T.start;
Â Â document.getElementById("t_sub").textContent = T.sub;
Â Â document.getElementById("t_share").textContent = T.share;
Â Â document.getElementById("ruleText").innerHTML = T.rule;

Â Â /************ prize setup (9 ç­‰åˆ†ï¼Œå« ğŸ one more chance) ************/
Â Â const prizes = [
Â Â Â Â "1 ğŸ˜¢ sorry",
Â Â Â Â "45â° or 60â° / 10 off",
Â Â Â Â "3 ğŸ˜¢ sorry",
Â Â Â Â "45â° or 60â° / 20 off",
Â Â Â Â "ğŸ one more chance",
Â Â Â Â "8 ğŸ˜¢ sorry",
Â Â Â Â "45â° or 60â° / 40 off",
Â Â Â Â "5 ğŸ˜¢ sorry",
Â Â Â Â "45â° or 60â° / 10 off"
Â Â ];
Â Â const segColors = ["#cfe6ff","#ffe0e0","#e9f7ff","#ffe6c9","#fff0b8","#e6ddff","#e6f1ff","#ffe0f0","#e9f7ff"];

Â Â /************ canvas sizing & draw ************/
Â Â const wheel = document.getElementById('wheel');
Â Â const ctx = wheel.getContext('2d');

Â Â const DPR = Math.max(2, window.devicePixelRatio || 1); // é«˜è§£æï¼Œå­—é«”ç©©å®š
Â Â const size = 640;
Â Â wheel.widthÂ Â = size * DPR;
Â Â wheel.height = size * DPR;

Â Â const W = wheel.width, H = wheel.height;
Â Â const R = Math.min(W, H)/2 * 0.82;
Â Â const CX = W/2, CY = H/2;
Â Â const n = prizes.length;
Â Â const segAngle = 2*Math.PI / n;
Â Â let currentRotation = 0;

Â Â function drawWheel(){
Â Â Â Â ctx.clearRect(0,0,W,H);
Â Â Â Â ctx.save();
Â Â Â Â ctx.translate(CX, CY);
Â Â Â Â ctx.rotate(currentRotation);
Â Â Â Â ctx.rotate(-Math.PI/2);Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // 12é»æ–¹å‘ç‚ºèµ·é»

Â Â Â Â for(let i=0;i<n;i++){
Â Â Â Â Â Â // å€å¡Š
Â Â Â Â Â Â ctx.beginPath();
Â Â Â Â Â Â ctx.moveTo(0,0);
Â Â Â Â Â Â ctx.fillStyle = segColors[i % segColors.length];
Â Â Â Â Â Â ctx.arc(0,0,R, i*segAngle, (i+1)*segAngle);
Â Â Â Â Â Â ctx.closePath(); ctx.fill();

Â Â Â Â Â Â // æ–‡å­—
Â Â Â Â Â Â ctx.save();
Â Â Â Â Â Â ctx.rotate(i*segAngle + segAngle/2);
Â Â Â Â Â Â ctx.textAlign = "center";
Â Â Â Â Â Â ctx.fillStyle = "#2b2b2b";
Â Â Â Â Â Â ctx.font = `${22*DPR}px Arial, Helvetica, sans-serif`;
Â Â Â Â Â Â ctx.translate(R*0.68,0);
Â Â Â Â Â Â ctx.rotate(Math.PI/2);
Â Â Â Â Â Â wrapText(ctx, prizes[i], 0, 0, R*0.42, 26*DPR);
Â Â Â Â Â Â ctx.restore();
Â Â Â Â }
Â Â Â Â ctx.restore();
Â Â }

Â Â function wrapText(ctx,text,x,y,maxWidth,lineHeight){
Â Â Â Â const words = text.split(' ');
Â Â Â Â let line = '', yy = y;
Â Â Â Â for(let k=0;k<words.length;k++){
Â Â Â Â Â Â const test = line + words[k] + ' ';
Â Â Â Â Â Â if (ctx.measureText(test).width > maxWidth && k>0){
Â Â Â Â Â Â Â Â ctx.fillText(line,x,yy);
Â Â Â Â Â Â Â Â line = words[k] + ' ';
Â Â Â Â Â Â Â Â yy += lineHeight;
Â Â Â Â Â Â }else{
Â Â Â Â Â Â Â Â line = test;
Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â ctx.fillText(line,x,yy);
Â Â }

Â Â /************ period = 3 å¤© ************/
Â Â const PERIOD_DAYS = 3;

Â Â function periodKey3d(){
Â Â Â Â const now = Date.now();
Â Â Â Â const msPer3d = PERIOD_DAYS * 24*3600*1000;
Â Â Â Â return `p${Math.floor(now/msPer3d)}`;
Â Â }

Â Â /************ ç‹€æ…‹ï¼ˆlocalStorageï¼‰ ************/
Â Â const KEY = "pcd_wheel_v2";
Â Â function loadState(){
Â Â Â Â const raw = JSON.parse(localStorage.getItem(KEY) || "{}");
Â Â Â Â const key = periodKey3d();
Â Â Â Â if(raw.pkey !== key){
Â Â Â Â Â Â return { pkey:key, used:0, bonus:0, subscribed:false, shared:false };
Â Â Â Â }
Â Â Â Â return raw;
Â Â }
Â Â function saveState(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

Â Â let state = loadState();

Â Â function baseAllowance(){
Â Â Â Â return 1 + (state.subscribed && state.shared ? 1 : 0);
Â Â }
Â Â function totalAllowance(){Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // å« ğŸ åŠ ç¢¼
Â Â Â Â return baseAllowance() + (state.bonus||0);
Â Â }
Â Â function remaining(){ return Math.max(0, totalAllowance() - (state.used||0)); }

Â Â function updateRemainingUI(){
Â Â Â Â const el = document.getElementById("remaining");
Â Â Â Â el.textContent = T.remain(remaining(), PERIOD_DAYS);
Â Â }

Â Â function updateStatus(){
Â Â Â Â const s = document.getElementById("status");
Â Â Â Â const sub = state.subscribed ? "âœ…" : "âŒ";
Â Â Â Â const shr = state.shared ? "âœ…" : "âŒ";
Â Â Â Â s.innerHTML = `Allowance: ${totalAllowance()} (used ${state.used||0}) Â· subscribe/share: ${sub}/${shr}`;
Â Â }

Â Â /************ Spin å‹•ç•« ************/
Â Â let spinning = false;
Â Â function spin(){
Â Â Â Â if(spinning) return;
Â Â Â Â if(remaining()<=0){ alert(T.usedOut); return; }

Â Â Â Â spinning = true;
Â Â Â Â startBtn.disabled = true;

Â Â Â Â const targetIndex = Math.floor(Math.random()*n);
Â Â Â Â const targetAngle = -Math.PI/2 - (targetIndex*segAngle + segAngle/2);
Â Â Â Â const extra = (Math.PI*2) * 6;
Â Â Â Â const finalRot = normalize(currentRotation + extra + shortestDelta(currentRotation, targetAngle));

Â Â Â Â const t0 = performance.now();
Â Â Â Â const D = 4200;
Â Â Â Â (function anim(t){
Â Â Â Â Â Â const p = Math.min(1,(t-t0)/D);
Â Â Â Â Â Â const ease = 1 - Math.pow(1-p,3);
Â Â Â Â Â Â currentRotation = currentRotation + (finalRot-currentRotation)*ease;
Â Â Â Â Â Â drawWheel();
Â Â Â Â Â Â if(p<1){ requestAnimationFrame(anim); }
Â Â Â Â Â Â else{
Â Â Â Â Â Â Â Â currentRotation = normalize(finalRot);
Â Â Â Â Â Â Â Â drawWheel();
Â Â Â Â Â Â Â Â const idx = indexByRotation(currentRotation);
Â Â Â Â Â Â Â Â finish(prizes[idx], idx);
Â Â Â Â Â Â }
Â Â Â Â })(t0);
Â Â }

Â Â function shortestDelta(from, to){
Â Â Â Â let d = to - (from % (2*Math.PI));
Â Â Â Â if(d >Â Â Math.PI) d -= 2*Math.PI;
Â Â Â Â if(d < -Math.PI) d += 2*Math.PI;
Â Â Â Â return d;
Â Â }
Â Â function normalize(a){ a%=2*Math.PI; if(a<0) a+=2*Math.PI; return a; }
Â Â function indexByRotation(rot){
Â Â Â Â const a = normalize(rot);
Â Â Â Â const top = a;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // æŒ‡é‡åœ¨ 12 é»
Â Â Â Â return Math.floor(((2*Math.PI - top) / segAngle)) % n;
Â Â }

Â Â /************ å®Œæˆä¸€æ¬¡æŠ½ç ************/
Â Â function finish(text, index){
Â Â Â Â state.used = (state.used||0) + 1;

Â Â Â Â // ğŸ one more chanceï¼šé¡å¤– +1ï¼ˆæœ¬æ¬¡å·²ç”¨ï¼Œç­‰æ–¼æ·¨å¤š 0ï¼Œä½†ä¸‹æ¬¡å¯å†å¤šä¸€æ¬¡ï¼‰
Â Â Â Â let bonusGranted = false;
Â Â Â Â if (/one\s+more\s+chance/i.test(text)) {
Â Â Â Â Â Â state.bonus = (state.bonus||0) + 1;
Â Â Â Â Â Â bonusGranted = true;
Â Â Â Â }

Â Â Â Â saveState(state);
Â Â Â Â updateRemainingUI();
Â Â Â Â updateStatus();
Â Â Â Â alert(T.congrats + prizes[index]);

Â Â Â Â // å›å‚³çµ¦ Telegram bot
Â Â Â Â const payload = {
Â Â Â Â Â Â event: "spin_result",
Â Â Â Â Â Â result: prizes[index],
Â Â Â Â Â Â index,
Â Â Â Â Â Â used: state.used,
Â Â Â Â Â Â allowance: totalAllowance(),
Â Â Â Â Â Â baseAllowance: baseAllowance(),
Â Â Â Â Â Â bonus: state.bonus||0,
Â Â Â Â Â Â remaining: remaining(),
Â Â Â Â Â Â subscribed: state.subscribed,
Â Â Â Â Â Â shared: state.shared,
Â Â Â Â Â Â bonusGranted,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // æ˜¯å¦å›  ğŸ åŠ éä¸€æ¬¡
Â Â Â Â Â Â lang: isCN ? "zh" : "en",
Â Â Â Â Â Â periodDays: PERIOD_DAYS,
Â Â Â Â Â Â periodKey: state.pkey,
Â Â Â Â Â Â ts: new Date().toISOString(),
Â Â Â Â Â Â version: "v2.0"
Â Â Â Â };
Â Â Â Â try{ tg?.sendData(JSON.stringify(payload)); }catch(e){}

Â Â Â Â startBtn.disabled = remaining()<=0;
Â Â Â Â spinning = false;
Â Â }

Â Â /************ Buttons ************/
Â Â const startBtn = document.getElementById('startBtn');
Â Â const subBtnÂ Â Â = document.getElementById('subBtn');
Â Â const shareBtn = document.getElementById('shareBtn');

Â Â startBtn.addEventListener('click', spin);

Â Â subBtn.addEventListener('click', () => {
Â Â Â Â window.open('https://t.me/pcatdolls','_blank');
Â Â Â Â state.subscribed = true; saveState(state);
Â Â Â Â updateRemainingUI(); updateStatus();
Â Â Â Â startBtn.disabled = remaining()<=0;
Â Â });

Â Â shareBtn.addEventListener('click', async () => {
Â Â Â Â const data = {title:'PCD Lucky Wheel', text:'Try your luck!', url:location.href};
Â Â Â Â try{
Â Â Â Â Â Â if(navigator.share){ await navigator.share(data); }
Â Â Â Â Â Â else{
Â Â Â Â Â Â Â Â window.open(`https://t.me/share/url?url=${encodeURIComponent(location.href)}&text=${encodeURIComponent(data.text)}`,'_blank');
Â Â Â Â Â Â }
Â Â Â Â Â Â state.shared = true; saveState(state);
Â Â Â Â Â Â updateRemainingUI(); updateStatus();
Â Â Â Â Â Â startBtn.disabled = remaining()<=0;

Â Â Â Â Â Â // å¯é¸ï¼šæŠŠåˆ†äº«äº‹ä»¶ä¹Ÿå›å‚³
Â Â Â Â Â Â try{ tg?.sendData(JSON.stringify({event:"share", lang:isCN?"zh":"en", ts:new Date().toISOString()})); }catch(e){}
Â Â Â Â }catch(e){}
Â Â });

Â Â /************ Init ************/
Â Â tg?.expand(); tg?.ready();
Â Â drawWheel();
Â Â updateRemainingUI();
Â Â updateStatus();
Â Â startBtn.disabled = remaining()<=0;

Â Â // ä¸èª¿æ•´ canvas å°ºå¯¸ï¼Œé¿å…å­—é«”å†è¨ˆç®—é€ æˆè·³å‹•
})();
</script>
</body>
</html>
