<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PCD Lucky Wheel â€” CN/EN</title>
<style>
Â Â :root{
Â Â Â Â --brand:#6e2b74;Â Â Â Â Â Â Â Â /* æŒ‡é’ˆ/å¼ºè°ƒ ç´« */
Â Â Â Â --ring:#eadcf3;Â Â Â Â Â Â Â Â Â /* å¤–åœˆæµ…ç´« */
Â Â Â Â --card:#ffffff;
Â Â Â Â --bg1:#fbf1ff;
Â Â Â Â --shadow:0 8px 30px rgba(0,0,0,.08);
Â Â Â Â --text:#2b2b2b;
Â Â Â Â --muted:#7d7d7d;
Â Â }
Â Â *{box-sizing:border-box}
Â Â html,body{height:100%;margin:0}
Â Â body{
Â Â Â Â display:flex;align-items:center;justify-content:center;min-height:100vh;
Â Â Â Â background:radial-gradient(1200px 600px at 50% -200px,var(--bg1),#fff);
Â Â Â Â font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Helvetica,Arial,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;
Â Â Â Â color:var(--text);
Â Â }
Â Â .card{
Â Â Â Â width:min(680px,96vw);
Â Â Â Â background:var(--card);border-radius:28px;padding:22px 20px 26px;
Â Â Â Â box-shadow:var(--shadow);
Â Â }
Â Â .stage{
Â Â Â Â position:relative;background:#fff;border-radius:22px;padding:18px;
Â Â Â Â box-shadow:inset 0 0 0 2px #f2e9f7;
Â Â }
Â Â .wheelWrap{position:relative; width:100%; aspect-ratio:1/1;}
Â Â canvas{width:100%;height:100%;display:block; border-radius:50%;
Â Â Â Â box-shadow:inset 0 0 0 14px var(--ring), inset 0 0 0 3px #fff;}
Â Â /* ä¸­å¿ƒç´«è‰²åœ“ + å‘ä¸Šå°ä¸‰è§’ç•¶æŒ‡é‡ï¼ˆè½‰ç›¤æœ¬é«”æ—‹è½‰ã€æŒ‡é‡å›ºå®šï¼‰ */
Â Â .center-pointer{
Â Â Â Â position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
Â Â Â Â width:22%;aspect-ratio:1/1;border-radius:50%;
Â Â Â Â background:
Â Â Â Â Â Â radial-gradient(circle at 50% 50%, #fff 0 36%, #ffffff 36%, var(--brand) 36%, var(--brand) 100%);
Â Â Â Â display:flex;align-items:center;justify-content:center;filter:drop-shadow(0 6px 10px rgba(0,0,0,.12));
Â Â }
Â Â .center-pointer:before{
Â Â Â Â content:"";width:0;height:0;position:absolute;top:6.5%;
Â Â Â Â left:50%;transform:translate(-50%, -50%);
Â Â Â Â border-left:12px solid transparent;border-right:12px solid transparent;
Â Â Â Â border-bottom:18px solid var(--brand); /* å°ä¸‰è§’æœä¸Šï¼ˆæŒ‡é‡å°–ç«¯ï¼‰ */
Â Â }
Â Â .actions{display:flex;gap:14px;justify-content:center;margin:18px 0 8px}
Â Â .btn{
Â Â Â Â padding:14px 24px;border-radius:18px;border:0;cursor:pointer;
Â Â Â Â background:linear-gradient(180deg,#f7d1ff,#ffc2c2);
Â Â Â Â color:#632d79;font-weight:700;font-size:20px;box-shadow:var(--shadow);
Â Â }
Â Â .btn:disabled{opacity:.6;cursor:not-allowed}
Â Â .chipRow{display:flex;gap:14px;justify-content:center;margin:8px 0 10px}
Â Â .chip{
Â Â Â Â display:flex;align-items:center;gap:10px;border-radius:16px;padding:12px 16px;
Â Â Â Â background:#fff;box-shadow:var(--shadow);color:#3b3b3b;font-weight:600;
Â Â }
Â Â .chip .dot{font-size:20px}
Â Â .muted{color:var(--muted); text-align:center; font-size:14px;line-height:1.6}
Â Â .rule{margin-top:6px}
Â Â .status{margin-top:8px}
Â Â #remaining{margin-top:8px; text-align:center; color:#6d4ecb; font-weight:700;}
</style>
</head>
<body>
Â Â <div class="card">
Â Â Â Â <div class="stage">
Â Â Â Â Â Â <div class="wheelWrap">
Â Â Â Â Â Â Â Â <canvas id="wheel"></canvas>
Â Â Â Â Â Â Â Â <div class="center-pointer" aria-hidden="true"></div>
Â Â Â Â Â Â </div>
Â Â Â Â </div>

Â Â Â Â <div class="actions">
Â Â Â Â Â Â <button id="startBtn" class="btn">å¼€å§‹ / Start</button>
Â Â Â Â </div>

Â Â Â Â <div class="chipRow">
Â Â Â Â Â Â <button id="subBtn" class="chip"><span class="dot">âœ…</span><span id="subText">è®¢é˜… PCD / Subscribe PCD</span></button>
Â Â Â Â Â Â <button id="shareBtn" class="chip"><span class="dot">ğŸ”—</span><span id="shareText">åˆ†äº« / Share</span></button>
Â Â Â Â </div>

Â Â Â Â <div id="remaining">--</div>
Â Â Â Â <div id="rule" class="muted rule"></div>
Â Â Â Â <div id="status" class="muted status"></div>
Â Â </div>

<script>
(() => {
Â Â /************** i18nï¼šè‡ªå‹•é›™èªï¼ˆç°¡ä¸­ / è‹±ï¼‰ **************/
Â Â const lang = (navigator.language || navigator.userLanguage || 'en').toLowerCase();
Â Â const isZH = lang.startsWith('zh'); // ä¸­æ–‡ä¸€å¾‹è¦–ç‚ºé¡¯ç¤ºç°¡é«”
Â Â const I18N = {
Â Â Â Â zh: {
Â Â Â Â Â Â start: 'å¼€å§‹ / Start',
Â Â Â Â Â Â subscribe: 'è®¢é˜… PCD / Subscribe PCD',
Â Â Â Â Â Â share: 'åˆ†äº« / Share',
Â Â Â Â Â Â rule: 'ğŸŒŸ æ¯ 3 å¤© 1 æ¬¡ï¼›å®Œæˆ è®¢é˜… + åˆ†äº« å† +1 æ¬¡ï¼›æŠ½åˆ° ğŸ one more chance å† +1 æ¬¡ã€‚',
Â Â Â Â Â Â remaining: (rem, all, period) => `å‰©ä½™æ¬¡æ•°ï¼š${rem} / ${all}ã€€(å‘¨æœŸ: ${period})`,
Â Â Â Â Â Â usedup: 'æœ¬æœŸæ¬¡æ•°å·²ç”¨å®Œï¼ˆæ¯ 3 å¤©é‡ç½®ï¼‰',
Â Â Â Â Â Â congrats: 'ğŸ‰ æ­å–œä¸­å¥–ï¼',
Â Â Â Â Â Â sorry: 'ğŸ˜¢ å¾ˆé—æ†¾',
Â Â Â Â Â Â oneMore: 'ğŸ one more chance',
Â Â Â Â Â Â status: (allow, used, sub, sh) => `æœ¬æœŸå¯ç”¨ï¼š${allow} æ¬¡ï¼ˆå·²ç”¨ ${used}ï¼‰Â· è®¢é˜…/åˆ†äº«ï¼š${sub}/${sh}`
Â Â Â Â },
Â Â Â Â en: {
Â Â Â Â Â Â start: 'Start',
Â Â Â Â Â Â subscribe: 'Subscribe PCD',
Â Â Â Â Â Â share: 'Share',
Â Â Â Â Â Â rule: 'ğŸŒŸ Every 3 days 1 spin; +1 after subscribing + sharing; +1 on ğŸ one more chance.',
Â Â Â Â Â Â remaining: (rem, all, period) => `Remaining: ${rem} / ${all}Â Â (Period: ${period})`,
Â Â Â Â Â Â usedup: 'No spins left this period (resets every 3 days).',
Â Â Â Â Â Â congrats: 'ğŸ‰ Congratulations!',
Â Â Â Â Â Â sorry: 'ğŸ˜¢ sorry',
Â Â Â Â Â Â oneMore: 'ğŸ one more chance',
Â Â Â Â Â Â status: (allow, used, sub, sh) => `Allowance: ${allow} (used ${used}) Â· subscribe/share: ${sub}/${sh}`
Â Â Â Â }
Â Â };
Â Â const T = isZH ? I18N.zh : I18N.en;

Â Â // å¥—ç”¨æ–‡æ¡ˆ
Â Â const startBtn = document.getElementById('startBtn');
Â Â const subBtnÂ Â Â = document.getElementById('subBtn');
Â Â const shareBtn = document.getElementById('shareBtn');
Â Â const subTextÂ Â = document.getElementById('subText');
Â Â const shareText= document.getElementById('shareText');
Â Â const ruleElÂ Â Â = document.getElementById('rule');
Â Â const statusEl = document.getElementById('status');
Â Â const remainingEl = document.getElementById('remaining');

Â Â startBtn.textContent = T.start;
Â Â subText.textContentÂ Â = T.subscribe;
Â Â shareText.textContent= T.share;
Â Â ruleEl.textContentÂ Â Â = T.rule;

Â Â /************** Telegram WebApp **************/
Â Â const TG = window.Telegram && Telegram.WebApp ? Telegram.WebApp : null;
Â Â if (TG){ TG.expand(); TG.ready(); }

Â Â /************** ä¸‰å¤©é€±æœŸç‹€æ…‹ï¼ˆperiodï¼‰ **************/
Â Â const KEY = "pcd_wheel_cn_en_period3d_v1";
Â Â function periodKey3d(){
Â Â Â Â // ä»¥å›ºå®š epoch åˆ‡ 3 å¤©ä¸€å€‹é€±æœŸï¼šp0, p1, ...
Â Â Â Â const epoch = new Date(2025,0,1).getTime();
Â Â Â Â const nowÂ Â Â = Date.now();
Â Â Â Â return 'p' + Math.floor((now - epoch) / (3*24*3600*1000));
Â Â }
Â Â function loadState(){
Â Â Â Â try{ return JSON.parse(localStorage.getItem(KEY) || '{}') || {}; }
Â Â Â Â catch(_){ return {}; }
Â Â }
Â Â function saveState(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

Â Â let state = loadState();
Â Â const currentPeriod = periodKey3d();
Â Â if (state.period !== currentPeriod){
Â Â Â Â state = {period: currentPeriod, used: 0, subscribed: false, shared: false, bonus: 0};
Â Â Â Â saveState(state);
Â Â }

Â Â // å¯ç”¨æ¬¡æ•¸ï¼šåŸºæœ¬ 1 + (è¨‚é–±ä¸”åˆ†äº«?1:0) + bonusï¼ˆæŠ½åˆ° one more chanceï¼‰
Â Â function allowance(){ return 1 + (state.subscribed && state.shared ? 1 : 0) + (state.bonus||0); }
Â Â function remaining(){ return Math.max(0, allowance() - (state.used||0)); }

Â Â function updateStatus(){
Â Â Â Â const sub = state.subscribed ? "âœ…" : "âŒ";
Â Â Â Â const shr = state.sharedÂ Â Â Â Â ? "âœ…" : "âŒ";
Â Â Â Â statusEl.textContent = T.status(allowance(), state.used||0, sub, shr);
Â Â Â Â remainingEl.textContent = T.remaining(remaining(), allowance(), state.period);
Â Â Â Â startBtn.disabled = remaining() <= 0;
Â Â }

Â Â /************** è½‰ç›¤ï¼ˆ9 ç­‰åˆ†ï¼Œå« ğŸ one more chanceï¼›â° ç¬¦è™Ÿï¼‰ **************/
Â Â const prizes = [
Â Â Â Â `1 ${T.sorry}`,
Â Â Â Â "45â° or 60â° / 10 off",
Â Â Â Â `3 ${T.sorry}`,
Â Â Â Â "45â° or 60â° / 20 off",
Â Â Â Â T.oneMore,
Â Â Â Â "45â° or 60â° / 40 off",
Â Â Â Â `8 ${T.sorry}`,
Â Â Â Â "45â° or 60â° / 10 off",
Â Â Â Â `5 ${T.sorry}`
Â Â ];
Â Â const segColors = ["#cde","#ffd7d7","#cfe9ff","#ffd7a8","#fff1b3","#ffd7e6","#d7d0ff","#cde","#efe1ff"];

Â Â const wheel = document.getElementById('wheel');
Â Â const ctxÂ Â Â = wheel.getContext('2d');

Â Â // ç•«å¸ƒå¤§å°ï¼ˆé«˜ DPIï¼‰
Â Â const DPR = Math.max(2, window.devicePixelRatio || 1);
Â Â const size = 640; wheel.width = size*DPR; wheel.height = size*DPR;
Â Â const W = wheel.width, H = wheel.height, R = Math.min(W,H)/2 * 0.82;
Â Â const CX = W/2, CY = H/2;
Â Â const nÂ Â = prizes.length;
Â Â const segA = 2*Math.PI / n;
Â Â let currentRotation = 0;

Â Â function drawWheel(){
Â Â Â Â ctx.clearRect(0,0,W,H);
Â Â Â Â ctx.save();
Â Â Â Â ctx.translate(CX, CY);
Â Â Â Â ctx.rotate(currentRotation);
Â Â Â Â // è®“ 12 é»é˜æ–¹å‘ç‚º 0 åº¦ï¼Œä¸”æ¯ç‰‡ä»¥ä¸­å¿ƒç·šå°é½Šæ–‡å­—
Â Â Â Â ctx.rotate(-Math.PI/2);

Â Â Â Â for(let i=0;i<n;i++){
Â Â Â Â Â Â // æ‰‡å½¢
Â Â Â Â Â Â ctx.beginPath();
Â Â Â Â Â Â ctx.moveTo(0,0);
Â Â Â Â Â Â ctx.fillStyle = segColors[i % segColors.length];
Â Â Â Â Â Â ctx.arc(0,0,R, i*segA, (i+1)*segA);
Â Â Â Â Â Â ctx.closePath(); ctx.fill();

Â Â Â Â Â Â // æ–‡å­—
Â Â Â Â Â Â ctx.save();
Â Â Â Â Â Â ctx.rotate(i*segA + segA/2);
Â Â Â Â Â Â ctx.textAlign = "center";
Â Â Â Â Â Â ctx.fillStyle = "#2b2b2b";
Â Â Â Â Â Â ctx.font = `${22*DPR}px Arial`;
Â Â Â Â Â Â ctx.translate(R*0.68, 0);
Â Â Â Â Â Â ctx.rotate(Math.PI/2);
Â Â Â Â Â Â wrapText(prizes[i], 0, 0, R*0.42, 26*DPR);
Â Â Â Â Â Â ctx.restore();
Â Â Â Â }
Â Â Â Â ctx.restore();
Â Â }

Â Â function wrapText(text,x,y,maxWidth,lineHeight){
Â Â Â Â let line = '', yy = y;
Â Â Â Â const words = (''+text).split(' ');
Â Â Â Â for(let i=0;i<words.length;i++){
Â Â Â Â Â Â const test = line + (line?' ':'') + words[i];
Â Â Â Â Â Â if (ctx.measureText(test).width > maxWidth && i>0){
Â Â Â Â Â Â Â Â ctx.fillText(line, x, yy);
Â Â Â Â Â Â Â Â line = words[i]; yy += lineHeight;
Â Â Â Â Â Â }else{
Â Â Â Â Â Â Â Â line = test;
Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â ctx.fillText(line, x, yy);
Â Â }

Â Â function normalize(a){ a%=2*Math.PI; if(a<0)a+=2*Math.PI; return a; }
Â Â function indexByRotation(rot){
Â Â Â Â // æŒ‡é‡å›ºå®šåœ¨ 12 é»ï¼›æ±‚ 12 é»è½åœ¨ç¬¬å¹¾ç‰‡ï¼ˆä»¥ segA åˆ‡åˆ†ï¼‰
Â Â Â Â const a = normalize(rot);
Â Â Â Â const rel = normalize(0 - a); // 0=12é»æ–¹å‘
Â Â Â Â return Math.floor(rel / segA) % n;
Â Â }
Â Â function shortest(from,to){
Â Â Â Â let d = to - (from % (2*Math.PI));
Â Â Â Â if (d >Â Â Math.PI) d -= 2*Math.PI;
Â Â Â Â if (d < -Math.PI) d += 2*Math.PI;
Â Â Â Â return d;
Â Â }

Â Â /************** æ—‹è½‰å‹•ç•« **************/
Â Â function spin(){
Â Â Â Â if(remaining()<=0){ alert(T.usedup); return; }
Â Â Â Â startBtn.disabled = true;

Â Â Â Â const targetIndex = Math.floor(Math.random()*n);
Â Â Â Â const targetAngle = - (targetIndex*segA + segA/2) - Math.PI/2; // è®“ç›®æ¨™æ‰‡å½¢ä¸­å¿ƒåˆ° 12 é»
Â Â Â Â const extra = (Math.PI*2) * 6; // å¤šè½‰å¹¾åœˆ
Â Â Â Â const finalRot = normalize(currentRotation + extra + shortest(currentRotation, targetAngle));

Â Â Â Â const t0 = performance.now(), D = 4200;
Â Â Â Â (function anim(t){
Â Â Â Â Â Â const p = Math.min(1, (t - t0)/D);
Â Â Â Â Â Â const e = 1 - Math.pow(1-p, 3); // ease-out
Â Â Â Â Â Â const rot = currentRotation + (finalRot - currentRotation)*e;
Â Â Â Â Â Â currentRotation = rot;
Â Â Â Â Â Â drawWheel();
Â Â Â Â Â Â if (p < 1) requestAnimationFrame(anim);
Â Â Â Â Â Â else {
Â Â Â Â Â Â Â Â currentRotation = normalize(finalRot);
Â Â Â Â Â Â Â Â drawWheel();
Â Â Â Â Â Â Â Â const idx = indexByRotation(currentRotation);
Â Â Â Â Â Â Â Â finish(prizes[idx], idx);
Â Â Â Â Â Â }
Â Â Â Â })(t0);
Â Â }

Â Â /************** çµæœè™•ç†ï¼ˆğŸ åŠ ä¸€æ¬¡ã€sendData å®Œæ•´ payloadï¼‰ **************/
Â Â function finish(text, index){
Â Â Â Â // å…ˆæ‰£ä¸€æ¬¡
Â Â Â Â state.used = (state.used||0) + 1;

Â Â Â Â // è‹¥ç‚º one more chance â†’ ç•¶æœŸ bonus +1ï¼ˆç­‰æ–¼å†å¤šä¸€æ¬¡ï¼‰
Â Â Â Â const gotBonus = /one\s*more\s*chance/i.test(text);
Â Â Â Â if (gotBonus){
Â Â Â Â Â Â state.bonus = (state.bonus || 0) + 1;
Â Â Â Â }

Â Â Â Â saveState(state);
Â Â Â Â updateStatus();

Â Â Â Â alert(`${T.congrats}\n\n${text}`);

Â Â Â Â // å›å‚³å®Œæ•´è³‡æ–™çµ¦ bot
Â Â Â Â if (TG){
Â Â Â Â Â Â const payload = {
Â Â Â Â Â Â Â Â bot_username: "pcd_luckywheel_bot",
Â Â Â Â Â Â Â Â type: "spin_result",
Â Â Â Â Â Â Â Â lang: isZH ? 'zh' : 'en',
Â Â Â Â Â Â Â Â result: text,
Â Â Â Â Â Â Â Â index,
Â Â Â Â Â Â Â Â prizes,
Â Â Â Â Â Â Â Â period: state.period,Â Â Â Â Â Â Â Â Â // ä¸‰å¤©é€±æœŸä»£è™Ÿ
Â Â Â Â Â Â Â Â used: state.used,
Â Â Â Â Â Â Â Â allowance: allowance(),
Â Â Â Â Â Â Â Â remaining: remaining(),
Â Â Â Â Â Â Â Â subscribed: !!state.subscribed,
Â Â Â Â Â Â Â Â shared: !!state.shared,
Â Â Â Â Â Â Â Â bonus: state.bonus||0,
Â Â Â Â Â Â Â Â bonus_added: gotBonus ? 1 : 0,
Â Â Â Â Â Â Â Â timestamp: new Date().toISOString()
Â Â Â Â Â Â };
Â Â Â Â Â Â try{ TG.sendData(JSON.stringify(payload)); }catch(e){}
Â Â Â Â }

Â Â Â Â startBtn.disabled = remaining()<=0;
Â Â }

Â Â /************** æŒ‰éˆ•ï¼šè¨‚é–± / åˆ†äº« **************/
Â Â subBtn.addEventListener('click', () => {
Â Â Â Â window.open('https://t.me/pcatdolls', '_blank');
Â Â Â Â state.subscribed = true; saveState(state); updateStatus();
Â Â });
Â Â shareBtn.addEventListener('click', async () => {
Â Â Â Â const text = isZH ? 'æ¥æŠ½å¥–ï¼è¯•è¯•æ‰‹æ°”ï¼' : 'Spin the wheel! Try your luck!';
Â Â Â Â try{
Â Â Â Â Â Â if (navigator.share){
Â Â Â Â Â Â Â Â await navigator.share({title:'PCD Lucky Wheel', text, url:location.href});
Â Â Â Â Â Â }else{
Â Â Â Â Â Â Â Â window.open(`https://t.me/share/url?url=${encodeURIComponent(location.href)}&text=${encodeURIComponent(text)}`,'_blank');
Â Â Â Â Â Â }
Â Â Â Â Â Â state.shared = true; saveState(state); updateStatus();
Â Â Â Â }catch(_){}
Â Â });
Â Â startBtn.addEventListener('click', spin);

Â Â /************** åˆå§‹åŒ– **************/
Â Â drawWheel();
Â Â updateStatus();
})();
</script>
</body>
</html>
