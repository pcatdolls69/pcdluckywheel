<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¹¸è¿è½¬ç›˜ / Lucky Wheel</title>
<style>
Â Â body{
Â Â Â Â margin:0; color:#333;
Â Â Â Â font-family:'Noto Sans SC', Arial, sans-serif;
Â Â Â Â background: linear-gradient(180deg, #fde6ff 0%, #e4f2ff 100%);
Â Â Â Â display:flex; flex-direction:column; align-items:center; min-height:100vh;
Â Â }
Â Â h2{margin:20px 0 10px}
Â Â #wheel-container{position:relative; width:420px; height:420px; margin-top:10px}
Â Â canvas{
Â Â Â Â width:100%; height:100%; border-radius:50%;
Â Â Â Â box-shadow: 0 0 30px rgba(255,255,255,.85), 0 0 60px rgba(255,200,255,.6);
Â Â Â Â background:#fff;
Â Â }
Â Â #centerPointer{position:absolute; inset:0; pointer-events:none}
Â Â #centerPointer polygon{fill:#4b0082}

Â Â /* ä¸»æŒ‰é’®ï¼šç²‰ç´«æ¸å˜ï¼Œåœ†è§’ */
Â Â #spinBtn{
Â Â Â Â margin-top:20px; padding:14px 32px; font-size:18px; color:#fff; border:0; border-radius:16px;
Â Â Â Â background: linear-gradient(90deg, #e8b3ff, #bcd2ff);
Â Â Â Â box-shadow: 0 4px 10px rgba(0,0,0,.15); cursor:pointer;
Â Â }
Â Â #spinBtn:active{transform:scale(.98)}
Â Â #status{margin-top:10px; font-size:14px}

Â Â /* è®¢é˜… / åˆ†äº« åŒºå— */
Â Â .cta{
Â Â Â Â display:flex; gap:12px; margin-top:14px;
Â Â }
Â Â .cta button{
Â Â Â Â padding:10px 16px; border-radius:12px; border:2px solid #d0b3ff; background:#fff; color:#4b0c7a;
Â Â Â Â font-weight:700; cursor:pointer;
Â Â }
Â Â .cta button:active{transform:scale(.98)}

Â Â /* åº•éƒ¨æ³¨æ„ */
Â Â #footer{margin:18px 0 24px; text-align:center; font-size:13px}
Â Â #footer a{color:#6a00cc; font-weight:700; text-decoration:none}
</style>
</head>
<body>

<h2>å¹¸è¿è½¬ç›˜ / Lucky Wheel</h2>

<div id="wheel-container">
Â Â <canvas id="wheel" width="420" height="420"></canvas>
Â Â <!-- ä¸­å¿ƒæ·±ç´«ä¸‰è§’æŒ‡é’ˆï¼ˆä»ä¸­å¿ƒæŒ‡å‘ 12 ç‚¹ï¼Œå°–ç«¯ç•¥è¶…å‡ºåœ†ç›˜ï¼‰ -->
Â Â <svg id="centerPointer" viewBox="0 0 420 420" aria-hidden="true">
Â Â Â Â <polygon points="195,210 225,210 210,16"></polygon>
Â Â </svg>
</div>

<button id="spinBtn">å¼€å§‹æŠ½å¥– / Start</button>
<div id="status">å‰©ä½™æ¬¡æ•° / Chances: <span id="chances">3</span></div>

<div class="cta">
Â Â <button id="subBtn">ğŸ”— è®¢é˜… / Subscribeï¼ˆ+1ï¼‰</button>
Â Â <button id="shareBtn">ğŸ”— åˆ†äº« / Shareï¼ˆ+1ï¼‰</button>
</div>

<div id="footer">
Â Â âš ï¸ æ‰€æœ‰å¥–é¡¹ä¸èƒ½é‡å ä½¿ç”¨ / All prizes cannot be combined<br>
Â Â <a href="https://t.me/pcatdolls" target="_blank">pcatdolls é¢‘é“ / Channel</a>
</div>

<script>
/* ===== Telegram Mini App åˆå§‹åŒ– ===== */
const isTG = !!(window.Telegram && Telegram.WebApp);
if (isTG) Telegram.WebApp.ready();

/* ===== è½®ç›˜æ•°æ® ===== */
const prizes = [
Â Â "45â° or 60â° / 10 OFF",
Â Â "45â° or 60â° / 20 OFF",
Â Â "One more spin chance",
Â Â "45â° or 60â° / 10 OFF",
Â Â "Sorry ğŸ˜¢",
Â Â "45â° or 60â° / 20 OFF",
Â Â "Sorry ğŸ˜¢",
Â Â "45â° or 60â° / 40 OFF",
Â Â "Sorry ğŸ˜¢"
];
const colors = ["#ffd1e8","#cbb2fe","#b6e1ff","#ffe07a","#ffd1e8","#cbb2fe","#b6e1ff","#ffe07a","#ffd1e8"];

let chances = 3; // åˆå§‹æ¬¡æ•°ï¼ˆå¯æŒ‰éœ€æ”¹ï¼‰
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');

function drawWheel(angleOffset = 0) {
Â Â const cx = 210, cy = 210, r = 200;
Â Â const n = prizes.length;
Â Â const arc = 2*Math.PI / n;
Â Â ctx.clearRect(0,0,420,420);
Â Â for (let i=0;i<n;i++){
Â Â Â Â const start = i*arc + angleOffset;
Â Â Â Â const end = start + arc;

Â Â Â Â // æ‰‡å½¢
Â Â Â Â ctx.beginPath();
Â Â Â Â ctx.moveTo(cx,cy);
Â Â Â Â ctx.arc(cx,cy,r,start,end);
Â Â Â Â ctx.closePath();
Â Â Â Â ctx.fillStyle = colors[i];
Â Â Â Â ctx.fill();

Â Â Â Â // æ–‡æ¡ˆï¼ˆé»‘è‰²ï¼‰
Â Â Â Â ctx.save();
Â Â Â Â ctx.translate(cx,cy);
Â Â Â Â ctx.rotate(start + arc/2);
Â Â Â Â ctx.textAlign = "right";
Â Â Â Â ctx.textBaseline = "middle";
Â Â Â Â ctx.fillStyle = "#000";Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // âœ… é»‘è‰²
Â Â Â Â ctx.font = "bold 16px Arial, 'Noto Sans SC', sans-serif";
Â Â Â Â ctx.fillText(prizes[i], r-20, 0);
Â Â Â Â ctx.restore();
Â Â }
}
drawWheel();

/* ===== æŠ½å¥– ===== */
const spinBtn = document.getElementById('spinBtn');
const chancesEl = document.getElementById('chances');

function updateChances() {
Â Â chancesEl.textContent = chances;
Â Â spinBtn.disabled = chances <= 0;
}
updateChances();

spinBtn.addEventListener('click', () => {
Â Â if (chances <= 0) {
Â Â Â Â const msg = "æ¯äººä¸€æ¬¡ / No more chances.\nè®¢é˜…æˆ–åˆ†äº«å¯è·å¾— +1 / Subscribe or Share to get +1.";
Â Â Â Â if (isTG && Telegram.WebApp.showAlert) Telegram.WebApp.showAlert(msg); else alert(msg);
Â Â Â Â return;
Â Â }
Â Â chances--; updateChances();

Â Â const spinAngle = 360*5 + Math.random()*360; // äº”åœˆä»¥ä¸Š
Â Â const duration = 4200;
Â Â const start = performance.now();

Â Â function step(now){
Â Â Â Â const p = Math.min((now-start)/duration, 1);
Â Â Â Â const ease = 1 - Math.pow(1-p,3); // ç¼“å‡º
Â Â Â Â drawWheel(ease * spinAngle * Math.PI/180);
Â Â Â Â if (p < 1) requestAnimationFrame(step);
Â Â Â Â else onDone(spinAngle);
Â Â }
Â Â requestAnimationFrame(step);
});

function onDone(spinAngleDeg){
Â Â // è®¡ç®—ä¸­å¥–é¡¹ï¼ˆä¸ 12 ç‚¹æ–¹å‘å¯¹é½ï¼‰
Â Â const n = prizes.length;
Â Â const raw = (spinAngleDeg % 360) / 360;Â Â Â Â Â Â Â Â Â Â Â // 0..1
Â Â const idx = (n - 1 - Math.floor(raw * n)) % n;Â Â Â Â // æŒ‡é’ˆåœ¨ä¸Šæ–¹ï¼Œè§’åº¦è¶Šå¤§ç´¢å¼•è¶Šå°
Â Â const result = prizes[idx];

Â Â // å¼¹çª—ï¼ˆä¸­è‹±ï¼‰
Â Â const msg = /Sorry/.test(result)
Â Â Â Â ? "è°¢è°¢å‚ä¸ / Thanks for playing"
Â Â Â Â : "æ­å–œä¸­å¥– / Congratulations!\n" + result;
Â Â if (isTG && Telegram.WebApp.showPopup) {
Â Â Â Â Telegram.WebApp.showPopup({title:"å¹¸è¿è½¬ç›˜ / Lucky Wheel", message:msg, buttons:[{type:'ok', id:'ok'}]});
Â Â } else if (isTG && Telegram.WebApp.showAlert) {
Â Â Â Â Telegram.WebApp.showAlert(msg);
Â Â } else {
Â Â Â Â alert(msg);
Â Â }

Â Â // â€œOne more spin chanceâ€ +1
Â Â if (/One more spin chance/i.test(result)) { chances++; updateChances(); }

Â Â // å›ä¼ ç»™ä½ çš„ botï¼ˆMini Appï¼‰
Â Â if (isTG && Telegram.WebApp.sendData) {
Â Â Â Â try {
Â Â Â Â Â Â // å¦‚æœå¯å–å¾—ç”¨æˆ·åï¼ŒæŠŠåå­—ä¸€èµ·å›ä¼ 
Â Â Â Â Â Â const u = Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user;
Â Â Â Â Â Â const name = u ? ((u.first_name||'') + (u.last_name?(' '+u.last_name):'')) : 'Guest';
Â Â Â Â Â Â const handle = u && u.username ? ('@'+u.username) : '';
Â Â Â Â Â Â Telegram.WebApp.sendData(`Winner: ${name}${handle?' '+handle:''} | Result: ${result}`);
Â Â Â Â } catch(e){}
Â Â }

Â Â // ï¼ˆå¯é€‰ï¼‰ç›´æ¥å‘åˆ° @pcd_luckywheel_bot é¢‘é“/ç¾¤ â€”â€” ç”¨ä½ çš„ Token æ›¿æ¢
Â Â fetch("https://api.telegram.org/bot7779859704:AAHwAPPUhTQQRwVJ1FeGJUuY6BJ5vBmFths/sendMessage", {
Â Â Â Â method: "POST",
Â Â Â Â headers: { "Content-Type": "application/json" },
Â Â Â Â body: JSON.stringify({
Â Â Â Â Â Â chat_id: "@pcd_luckywheel_bot",
Â Â Â Â Â Â text: `ğŸ¯ æŠ½å¥–ç»“æœ / Result: ${result}`
Â Â Â Â })
Â Â }).catch(()=>{});
}

/* ===== è®¢é˜… & åˆ†äº«ï¼šå„ +1 ===== */
document.getElementById('subBtn').addEventListener('click', () => {
Â Â if (isTG) Telegram.WebApp.openTelegramLink('https://t.me/pcatdolls');
Â Â chances++; updateChances();
});

document.getElementById('shareBtn').addEventListener('click', () => {
Â Â try{
Â Â Â Â if (isTG && Telegram.WebApp.shareToStory) {
Â Â Â Â Â Â Telegram.WebApp.shareToStory({text:'PCD Lucky Wheel', widget_link:'https://t.me/pcatdolls'});
Â Â Â Â } else if (isTG) {
Â Â Â Â Â Â Telegram.WebApp.openTelegramLink('https://t.me/pcatdolls');
Â Â Â Â } else {
Â Â Â Â Â Â window.open('https://t.me/pcatdolls','_blank');
Â Â Â Â }
Â Â } finally {
Â Â Â Â chances++; updateChances();
Â Â }
});
</script>
</body>
</html>
