<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>PCD Lucky Wheel</title>
<style>
Â Â /* â€”â€” é¡µé¢ç™½åº• â€”â€” */
Â Â body{
Â Â Â Â margin:0; background:#fff; color:#333;
Â Â Â Â font-family:-apple-system,BlinkMacSystemFont,"PingFang SC","Microsoft YaHei",sans-serif;
Â Â Â Â display:flex; flex-direction:column; align-items:center; justify-content:center;
Â Â Â Â min-height:100vh; -webkit-tap-highlight-color:transparent; user-select:none;
Â Â }
Â Â h2{margin:10px 0 12px; text-align:center}
Â Â .container{position:relative; display:flex; flex-direction:column; align-items:center}

Â Â /* â€”â€” å›ºå®šå°ºå¯¸ç”»å¸ƒï¼ˆæœ€ç¨³å¦¥ï¼Œä¸ä¼šæ¶ˆå¤±ï¼‰â€”â€” */
Â Â #wheelCanvas{
Â Â Â Â width:360px; height:360px;Â Â Â Â Â Â Â Â Â Â Â Â /* CSS å°ºå¯¸ */
Â Â Â Â background:#fff; border-radius:50%;
Â Â Â Â box-shadow:inset 0 0 0 10px rgba(107,35,157,.14), 0 6px 14px rgba(0,0,0,.08);
Â Â Â Â display:block;
Â Â }
Â Â /* HTML å±æ€§å°ºå¯¸ï¼Œé¿å…å˜æˆ 0Ã—0 */
Â Â /* <canvas id="wheelCanvas" width="360" height="360"></canvas> ä¼šé…åˆä¸Šé¢çš„ CSS */

Â Â /* â€”â€” æ·±ç´«è‰²ä¸‰è§’æŒ‡é’ˆå›ºå®š 12 ç‚¹ â€”â€” */
Â Â .pointer{
Â Â Â Â position:absolute; top:calc(50% - 200px); left:50%; transform:translateX(-50%);
Â Â Â Â width:0; height:0; border-left:14px solid transparent; border-right:14px solid transparent;
Â Â Â Â border-bottom:26px solid #5c1898; filter:drop-shadow(0 2px 2px rgba(0,0,0,.2));
Â Â Â Â z-index:10;
Â Â }

Â Â /* â€”â€” ä¸­å¤®æ·±ç´«åœ†å¿ƒï¼ˆè£…é¥°ï¼‰â€”â€” */
Â Â .hub{
Â Â Â Â position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
Â Â Â Â width:24%; aspect-ratio:1/1; border-radius:50%; background:#5c1898;
Â Â Â Â box-shadow:0 2px 6px rgba(0,0,0,.18) inset, 0 0 0 10px #fff;
Â Â Â Â z-index:2; pointer-events:none;
Â Â }

Â Â /* â€”â€” æŒ‰é’®ã€æ¬¡æ•°ã€åº•éƒ¨è¯´æ˜ï¼ˆåº•éƒ¨æ‰ä¸­è‹±å¯¹ç…§ï¼‰â€”â€” */
Â Â #spinBtn{
Â Â Â Â margin-top:14px; padding:10px 18px; border:none; border-radius:10px;
Â Â Â Â background:#f7d3e8; color:#4b0c7a; font-weight:800; font-size:16px; cursor:pointer;
Â Â }
Â Â #spinBtn:disabled{opacity:.6; cursor:not-allowed}
Â Â #chances{margin-top:6px; font-size:14px}
Â Â .links{margin-top:10px}
Â Â .links a{color:#6b00c8; text-decoration:none; font-weight:700; margin:0 8px}
Â Â .note{margin-top:10px; font-size:12px; color:#444; text-align:center; line-height:1.5}
</style>
</head>
<body>
Â Â <h2>PCD Lucky Wheel<br><small>å¹¸è¿è½¬ç›˜ Â· Lucky Draw</small></h2>

Â Â <div class="container">
Â Â Â Â <div class="pointer" aria-hidden="true"></div>
Â Â Â Â <!-- âœ… åŒæ—¶æœ‰ CSS å’Œ HTML å°ºå¯¸ï¼Œä¿è¯ä¸ä¸º 0 -->
Â Â Â Â <canvas id="wheelCanvas" width="360" height="360"></canvas>
Â Â Â Â <div class="hub" aria-hidden="true"></div>
Â Â </div>

Â Â <!-- å¼€å§‹ / Startï¼ˆè½¬ç›˜æ­£ä¸‹æ–¹ï¼Œç®€ä½“+è‹±æ–‡ï¼‰ -->
Â Â <button id="spinBtn">ğŸ¯ å¼€å§‹ / Start</button>
Â Â <div id="chances">å‰©ä½™æ¬¡æ•° / Chances: --</div>

Â Â <!-- åªæœ‰æœ€ä¸‹é¢åŒè¯­ -->
Â Â <div class="links">
Â Â Â Â <a id="subLink" href="#">è®¢é˜… / Subscribe</a>Â·
Â Â Â Â <a id="shareLink" href="#">åˆ†äº« / Share</a>
Â Â </div>
Â Â <div class="note">
Â Â Â Â âš ï¸ æ‰€æœ‰å¥–é¡¹ä¸èƒ½é‡å ä½¿ç”¨ Â· Prizes cannot be combined<br>
Â Â Â Â è®¢é˜…å¹¶åˆ†äº«é¢‘é“å¯å¤šä¸€æ¬¡æœºä¼š Â· Subscribe &amp; Share for +1 spin
Â Â </div>

Â Â <!-- é¡ºåºå¾ˆé‡è¦ï¼šå…ˆ GSAPï¼Œå† Winwheel -->
Â Â <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.20.3/TweenMax.min.js"></script>
Â Â <script src="https://cdn.jsdelivr.net/npm/winwheel@2.8.0/Winwheel.min.js"></script>

Â Â <script>
Â Â (function(){
Â Â Â Â /* ===== é…è‰²ï¼ˆç²‰ã€ç´«ã€è“ã€é»„ï¼Œå¯¹æ¯”æ¸…æ¥šï¼‰ ===== */
Â Â Â Â const COLORS = ['#ffd1e8','#cbb2fe','#b6e1ff','#ffe07a'];

Â Â Â Â const SEGMENTS = [
Â Â Â Â Â Â { fillStyle: COLORS[0], text: '45â° or 60â°/ 10 off' },
Â Â Â Â Â Â { fillStyle: COLORS[1], text: '45â° or 60â°/ 20 off' },
Â Â Â Â Â Â { fillStyle: COLORS[2], text: 'One more spin chance' },
Â Â Â Â Â Â { fillStyle: COLORS[3], text: '45â° or 60â°/ 10 off' },
Â Â Â Â Â Â { fillStyle: COLORS[0], text: 'Sorry ğŸ˜¢' },
Â Â Â Â Â Â { fillStyle: COLORS[1], text: '45â° or 60â°/ 20 off' },
Â Â Â Â Â Â { fillStyle: COLORS[2], text: 'Sorry ğŸ˜¢' },
Â Â Â Â Â Â { fillStyle: COLORS[3], text: '45â° or 60â°/ 40 off' },
Â Â Â Â Â Â { fillStyle: COLORS[0], text: 'Sorry ğŸ˜¢' }
Â Â Â Â ];

Â Â Â Â /* ===== Telegram å°±ç»ª ===== */
Â Â Â Â const isTG = !!(window.Telegram && Telegram.WebApp);
Â Â Â Â if (isTG) { Telegram.WebApp.ready(); }

Â Â Â Â /* ===== èº«ä»½ & 3å¤©ä¸€æ¬¡é™åˆ¶ï¼ˆå¤–åŠ  bonusï¼‰ ===== */
Â Â Â Â const TG_USER = (isTG && Telegram.WebApp.initDataUnsafe && Telegram.WebApp.initDataUnsafe.user) || null;
Â Â Â Â const USER_ID = TG_USER ? String(TG_USER.id) : 'guest';
Â Â Â Â const KEY = 'pcd_wheel_' + USER_ID; // { lastBaseSpinISO, bonus }
Â Â Â Â function readState(){ try{ return JSON.parse(localStorage.getItem(KEY)) || {lastBaseSpinISO:null, bonus:0}; }catch(e){ return {lastBaseSpinISO:null, bonus:0}; } }
Â Â Â Â function writeState(s){ localStorage.setItem(KEY, JSON.stringify(s)); }
Â Â Â Â function baseAvailable(now=new Date()){ const s=readState(); if(!s.lastBaseSpinISO) return true; return (now - new Date(s.lastBaseSpinISO)) >= 3*24*60*60*1000; }
Â Â Â Â function totalChances(){ const s=readState(); return (baseAvailable()?1:0) + (s.bonus|0); }
Â Â Â Â function consume(){ const s=readState(); if(s.bonus>0) s.bonus--; else s.lastBaseSpinISO=new Date().toISOString(); writeState(s); }
Â Â Â Â function addBonus(n=1){ const s=readState(); s.bonus=(s.bonus|0)+n; writeState(s); }

Â Â Â Â /* ===== è®¢é˜…/åˆ†äº«ï¼šå„ +1 æ¬¡ ===== */
Â Â Â Â document.getElementById('subLink').onclick = (e)=>{
Â Â Â Â Â Â e.preventDefault();
Â Â Â Â Â Â if(isTG) Telegram.WebApp.openTelegramLink('https://t.me/pcatdolls');
Â Â Â Â Â Â addBonus(1); refresh();
Â Â Â Â };
Â Â Â Â document.getElementById('shareLink').onclick = (e)=>{
Â Â Â Â Â Â e.preventDefault();
Â Â Â Â Â Â try{
Â Â Â Â Â Â Â Â if(isTG && Telegram.WebApp.shareToStory){
Â Â Â Â Â Â Â Â Â Â Telegram.WebApp.shareToStory({text:'PCD Lucky Wheel', widget_link:'https://t.me/pcatdolls'});
Â Â Â Â Â Â Â Â }else if(isTG){
Â Â Â Â Â Â Â Â Â Â Telegram.WebApp.openTelegramLink('https://t.me/pcatdolls');
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â } finally {
Â Â Â Â Â Â Â Â addBonus(1); refresh();
Â Â Â Â Â Â }
Â Â Â Â };

Â Â Â Â /* ===== è½¬ç›˜ï¼ˆå›ºå®š 360 ç”»å¸ƒï¼Œå¤–åŠå¾„ 168ï¼Œç¡®ä¿å¯è§ï¼‰ ===== */
Â Â Â Â const canvas = document.getElementById('wheelCanvas'); // 360Ã—360
Â Â Â Â let wheel = null;

Â Â Â Â function buildWheel(){
Â Â Â Â Â Â wheel = new Winwheel({
Â Â Â Â Â Â Â Â canvasId: 'wheelCanvas',
Â Â Â Â Â Â Â Â numSegments: SEGMENTS.length,
Â Â Â Â Â Â Â Â outerRadius: 168,Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // 360/2 - ç•™å‡ºå¤–åœˆæè¾¹
Â Â Â Â Â Â Â Â textFontSize: 14,
Â Â Â Â Â Â Â Â textFillStyle: '#333',
Â Â Â Â Â Â Â Â segments: SEGMENTS,
Â Â Â Â Â Â Â Â animation:{
Â Â Â Â Â Â Â Â Â Â type:'spinToStop',
Â Â Â Â Â Â Â Â Â Â duration:5,
Â Â Â Â Â Â Â Â Â Â spins:8,
Â Â Â Â Â Â Â Â Â Â callbackFinished:onDone
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â });
Â Â Â Â }

Â Â Â Â /* ===== UI ===== */
Â Â Â Â const btn = document.getElementById('spinBtn');
Â Â Â Â const chancesEl = document.getElementById('chances');
Â Â Â Â function refresh(){
Â Â Â Â Â Â const t = totalChances();
Â Â Â Â Â Â chancesEl.textContent = 'å‰©ä½™æ¬¡æ•° / Chances: ' + t;
Â Â Â Â Â Â btn.disabled = t <= 0;
Â Â Â Â }

Â Â Â Â btn.onclick = ()=>{
Â Â Â Â Â Â if (totalChances() <= 0) {
Â Â Â Â Â Â Â Â const msg = 'æ¯äºº 3 å¤©å¯è½¬ 1 æ¬¡ï¼›è®¢é˜…/åˆ†äº«æˆ–æŠ½åˆ°ã€ŒOne more spin chanceã€å¯ +1 æ¬¡ã€‚\nOne spin every 3 days. Subscribe/Share or landing on bonus tile gives +1 chance.';
Â Â Â Â Â Â Â Â if (isTG && Telegram.WebApp.showAlert) Telegram.WebApp.showAlert(msg); else alert(msg);
Â Â Â Â Â Â Â Â return;
Â Â Â Â Â Â }
Â Â Â Â Â Â consume(); refresh();
Â Â Â Â Â Â btn.textContent = 'ğŸ° æ—‹è½¬ä¸­ / Spinningâ€¦'; btn.disabled = true;
Â Â Â Â Â Â wheel.startAnimation();
Â Â Â Â Â Â setTimeout(()=>{ btn.textContent='ğŸ¯ å¼€å§‹ / Start'; refresh(); }, 5200);
Â Â Â Â };

Â Â Â Â /* ===== ç»“æœå¤„ç† ===== */
Â Â Â Â function onDone(seg){
Â Â Â Â Â Â const text = seg?.text || '';
Â Â Â Â Â Â if (/One more spin chance/i.test(text)){ addBonus(1); refresh(); notify('è·å¾— +1 æ¬¡æœºä¼š Â· +1 extra chance'); }
Â Â Â Â Â Â else if (/Sorry/i.test(text)) { notify('è°¢è°¢å‚ä¸ Â· Thanks for playing'); }
Â Â Â Â Â Â else { notify('æ­å–œä¸­å¥–ï¼š'+text+'\nCongratulations!'); }

Â Â Â Â Â Â // å›ä¼ ç»™ @pcd_luckywheel_botï¼ˆå§“å + ç»“æœï¼‰
Â Â Â Â Â Â const u = TG_USER;
Â Â Â Â Â Â const name = u ? ((u.first_name||'') + (u.last_name?(' '+u.last_name):'')) : 'Guest';
Â Â Â Â Â Â const handle = u && u.username ? ('@'+u.username) : '';
Â Â Â Â Â Â const payload = `Winner: ${name}${handle?' '+handle:''} | Result: ${text}`;
Â Â Â Â Â Â if (isTG && Telegram.WebApp.sendData) { try{ Telegram.WebApp.sendData(payload); }catch(e){} }

Â Â Â Â Â Â try{ if(isTG && Telegram.WebApp.HapticFeedback){ Telegram.WebApp.HapticFeedback.notificationOccurred('success'); } }catch(e){}
Â Â Â Â }

Â Â Â Â function notify(message){
Â Â Â Â Â Â if (isTG && Telegram.WebApp.showPopup) Telegram.WebApp.showPopup({title:'PCD Lucky Wheel', message, buttons:[{type:'ok', id:'ok'}]});
Â Â Â Â Â Â else if (isTG && Telegram.WebApp.showAlert) Telegram.WebApp.showAlert(message);
Â Â Â Â Â Â else alert(message);
Â Â Â Â }

Â Â Â Â /* ===== åˆå§‹åŒ–ï¼ˆç­‰ window.onloadï¼Œ100% ä¸ä¸¢ç”»å¸ƒï¼‰ ===== */
Â Â Â Â window.addEventListener('load', function(){
Â Â Â Â Â Â buildWheel();
Â Â Â Â Â Â refresh();
Â Â Â Â });
Â Â })();
Â Â </script>
</body>
</html>
