<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PCD Lucky Wheel</title>
<style>
Â Â :root{
Â Â Â Â --bg:#faf6ff; --card:#ffffff; --accent:#7b2cbf; --muted:#6b7280;
Â Â Â Â --shadow:0 10px 20px rgba(31,27,65,.12);
Â Â }
Â Â *{box-sizing:border-box}
Â Â body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,'PingFang SC','Noto Sans SC','Noto Sans','Helvetica Neue',Arial,sans-serif;color:#222}
Â Â .card{max-width:720px;margin:28px auto;padding:20px 20px 28px;background:var(--card);border-radius:20px;box-shadow:var(--shadow)}
Â Â .stage{display:flex;justify-content:center;margin-top:6px}
Â Â #wheel{width:100%;max-width:560px;aspect-ratio:1;border-radius:24px;background:#f3ecff}
Â Â .center-pointer{position:relative;margin-top:-52%;height:0;pointer-events:none}
Â Â .center-pointer::after{
Â Â Â Â content:"";position:absolute;left:50%;transform:translateX(-50%);
Â Â Â Â border-left:14px solid transparent;border-right:14px solid transparent;border-bottom:24px solid var(--accent);
Â Â }
Â Â .actions{display:flex;justify-content:center;margin-top:18px}
Â Â .btn{
Â Â Â Â background:linear-gradient(180deg,#f2d6ff,#f8cddc);color:#5a189a;font-weight:800;
Â Â Â Â font-size:24px;padding:16px 28px;border:none;border-radius:18px;box-shadow:var(--shadow);cursor:pointer
Â Â }
Â Â .btn:disabled{opacity:.5;cursor:not-allowed}
Â Â .chipRow{display:flex;gap:12px;justify-content:center;margin:12px 0}
Â Â .chip{display:flex;align-items:center;gap:10px;border-radius:16px;padding:12px 16px;font-weight:700;background:#fff;box-shadow:var(--shadow);color:#3b3b3b}
Â Â .chip .dot{font-size:20px}
Â Â .muted{color:var(--muted);text-align:center;font-size:14px;line-height:1.6}
Â Â #remaining{margin-top:6px;text-align:center;color:#8666ff;font-weight:700}
</style>
</head>
<body>
Â Â <div class="card">
Â Â Â Â <div class="stage">
Â Â Â Â Â Â <canvas id="wheel"></canvas>
Â Â Â Â </div>
Â Â Â Â <div class="center-pointer" aria-hidden="true"></div>

Â Â Â Â <div class="actions">
Â Â Â Â Â Â <button id="startBtn" class="btn">å¼€å§‹ / Start</button>
Â Â Â Â </div>

Â Â Â Â <div id="remaining"></div>

Â Â Â Â <div class="chipRow">
Â Â Â Â Â Â <button id="subBtn"Â Â Â class="chip"><span class="dot">âœ…</span><span id="subText">è®¢é˜… PCD / Subscribe PCD</span></button>
Â Â Â Â Â Â <button id="shareBtn" class="chip"><span class="dot">ğŸ”—</span><span id="shareText">åˆ†äº« / Share</span></button>
Â Â Â Â </div>

Â Â Â Â <div id="rule" class="muted">
Â Â Â Â Â Â ğŸŒŸ æ¯ <b>3 å¤©</b> 1 æ¬¡ï¼›å®Œæˆ <b>è®¢é˜… + åˆ†äº«</b> å† +1 æ¬¡ã€‚æŠ½åˆ° <b>ğŸ one more chance</b> å†é€ +1 æ¬¡ã€‚<br/>
Â Â Â Â Â Â Every <b>3 days</b> 1 spin; +1 after subscribing + sharing; +1 on â€œğŸ one more chanceâ€.
Â Â Â Â </div>
Â Â </div>

Â Â <script src="https://telegram.org/js/telegram-web-app.js"></script>
Â Â <script>
Â Â const lang = (navigator.language || 'en').toLowerCase();
Â Â const isZH = lang.startsWith('zh');
Â Â const T = {
Â Â Â Â start: isZH ? 'å¼€å§‹ / Start' : 'Start',
Â Â Â Â rule: isZH ? 'ğŸŒŸ æ¯ 3 å¤© 1 æ¬¡ï¼›å®Œæˆ è®¢é˜… + åˆ†äº« å† +1 æ¬¡ã€‚æŠ½åˆ° ğŸ one more chance å†é€ +1 æ¬¡ã€‚' : 'ğŸŒŸ Every 3 days 1 spin; +1 after subscribing + sharing; +1 on â€œğŸ one more chanceâ€.',
Â Â Â Â sorry: isZH ? 'ğŸ˜¢ å¾ˆé—æ†¾' : 'ğŸ˜¢ sorry',
Â Â Â Â oneMore: 'ğŸ one more chance',
Â Â Â Â usedup: isZH ? 'æœ¬æœŸæ¬¡æ•°å·²ç”¨å®Œï¼ˆæ¯ 3 å¤©é‡ç½®ï¼‰' : 'No spins left this period (resets every 3 days)',
Â Â Â Â congrats: isZH ? 'ğŸ‰ æ­å–œä¸­å¥–ï¼' : 'ğŸ‰ Congratulations!'
Â Â };

Â Â document.getElementById('startBtn').textContent = T.start;
Â Â document.getElementById('rule').innerHTML = T.rule;

Â Â const TG = window.Telegram?.WebApp || null;
Â Â if (TG) TG.ready?.();

Â Â const LS_KEY = 'pcd_luckywheel_state_v3days';
Â Â const epoch = new Date(2025,0,1).getTime();
Â Â const bucket = Math.floor((Date.now() - epoch)/(3*24*3600*1000));
Â Â let state = JSON.parse(localStorage.getItem(LS_KEY)||'{}');
Â Â if (state.period !== bucket){
Â Â Â Â state = {period:bucket,used:0,subscribed:false,shared:false,bonus:0};
Â Â Â Â localStorage.setItem(LS_KEY,JSON.stringify(state));
Â Â }

Â Â function allowance(){return 1+(state.subscribed&&state.shared?1:0)+(state.bonus||0);}
Â Â function remaining(){return Math.max(0,allowance()-(state.used||0));}
Â Â const rem=document.getElementById('remaining');
Â Â function update(){rem.textContent=isZH?`å‰©ä½™æ¬¡æ•°ï¼š${remaining()} / ${allowance()}`:`Remaining: ${remaining()} / ${allowance()}`;start.disabled=remaining()<=0;}
Â Â const start=document.getElementById('startBtn');const sub=document.getElementById('subBtn');const share=document.getElementById('shareBtn');
Â Â sub.onclick=()=>{window.open('https://t.me/pcatdolls','_blank');state.subscribed=true;localStorage.setItem(LS_KEY,JSON.stringify(state));update();};
Â Â share.onclick=()=>{window.open('https://t.me/share/url?url='+encodeURIComponent(location.href),'_blank');state.shared=true;localStorage.setItem(LS_KEY,JSON.stringify(state));update();};

Â Â const wheel=document.getElementById('wheel');const ctx=wheel.getContext('2d');
Â Â const DPR=2,size=600;wheel.width=size*DPR;wheel.height=size*DPR;
Â Â const W=wheel.width,H=wheel.height,R=W/2*0.8,CX=W/2,CY=H/2;
Â Â const prizes=[
Â Â Â Â `1 ${T.sorry}`,
Â Â Â Â "45â° or 60â° / 10 off",
Â Â Â Â `3 ${T.sorry}`,
Â Â Â Â "45â° or 60â° / 10 off",
Â Â Â Â T.oneMore,
Â Â Â Â "45â° or 60â° / 20 off",
Â Â Â Â `8 ${T.sorry}`,
Â Â Â Â "45â° or 60â° / 40 off",
Â Â Â Â `5 ${T.sorry}`
Â Â ];
Â Â const segColors=["#e3f2fd","#ffd7d7","#e0f7fa","#ffd7d7","#fff3bf","#ffe9ec","#e8e0ff","#ffe9ec","#efe7ff"];
Â Â const n=prizes.length,segA=2*Math.PI/n;let rot=0;
Â Â function draw(){
Â Â Â Â ctx.clearRect(0,0,W,H);ctx.save();ctx.translate(CX,CY);ctx.rotate(rot-Math.PI/2);
Â Â Â Â for(let i=0;i<n;i++){ctx.beginPath();ctx.moveTo(0,0);ctx.fillStyle=segColors[i];ctx.arc(0,0,R,i*segA,(i+1)*segA);ctx.fill();
Â Â Â Â Â Â ctx.save();ctx.rotate(i*segA+segA/2);ctx.translate(R*0.72,0);ctx.rotate(Math.PI/2);ctx.fillStyle="#333";ctx.font=`${22*DPR}px Arial`;
Â Â Â Â Â Â wrap(prizes[i],0,0,R*0.38,28*DPR);ctx.restore();}
Â Â Â Â ctx.fillStyle="#a16de2";ctx.beginPath();ctx.arc(0,0,R*0.18,0,Math.PI*2);ctx.fill();
Â Â Â Â ctx.fillStyle="#fff";ctx.beginPath();ctx.arc(0,0,R*0.10,0,Math.PI*2);ctx.fill();ctx.restore();}
Â Â function wrap(t,x,y,m,l){const w=t.split(' ');let line='',yy=0;for(let i=0;i<w.length;i++){const test=line+w[i]+' ';if(ctx.measureText(test).width>m&&i>0){ctx.fillText(line,x,y+yy);line=w[i]+' ';yy+=l;}else line=test;}ctx.fillText(line,x,y+yy);}
Â Â function spin(){if(remaining()<=0){alert(T.usedup);return;}start.disabled=true;const idx=Math.floor(Math.random()*n);const fR=-idx*segA+(Math.PI*2)*6;
Â Â Â Â const s=performance.now(),D=4200;function anim(t){const p=Math.min(1,(t-s)/D),e=1-Math.pow(1-p,3);rot=rot+(fR-rot)*e;draw();if(p<1)requestAnimationFrame(anim);else end(idx);}requestAnimationFrame(anim);}
Â Â function end(i){state.used++;const txt=prizes[i];if(/one\s*more\s*chance/i.test(txt)){state.bonus++;}localStorage.setItem(LS_KEY,JSON.stringify(state));update();alert(`${T.congrats}\n\n${txt}`);if(TG){TG.sendData(JSON.stringify({result:txt,used:state.used,bonus:state.bonus,remaining:remaining()}));}}
Â Â draw();update();
Â Â </script>
</body>
</html>
