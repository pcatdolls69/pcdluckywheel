<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PCD Lucky Wheel ‚Äì EN/ZH Final</title>
  <style>
    :root{
      --purple:#C9A7EB;--pink:#FFB6C1;--sky:#A0D8EF;--yellow:#FFF1A8;--wine:#5E2A5A;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      min-height:100vh;padding:16px;background:radial-gradient(1200px 600px at 50% 0%,#FDF7FF 0%,#FFF7FB 50%,#FFFFFF 100%);
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:#222;
    }
    .card{background:#fff;border-radius:20px;padding:18px 16px 16px;box-shadow:0 12px 35px rgba(93,59,117,.18);
      display:flex;flex-direction:column;align-items:center;width:min(96vw,420px)}
    .canvas-wrap{position:relative;display:inline-block;border-radius:50%;padding:8px}
    #wheelCanvas{background:#fff;border-radius:50%;border:6px solid #E8DFF6;display:block}
    .needle{position:absolute;left:50%;top:0;transform-origin:center;transform:translateX(-50%) rotate(0deg);
      width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;
      border-bottom:26px solid var(--wine);z-index:3;transition:transform 5s cubic-bezier(.17,.67,.83,.67)}
    .hub{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:44px;height:44px;border-radius:50%;
      background:#fff;border:6px solid var(--wine);box-shadow:0 2px 6px rgba(0,0,0,.22) inset;z-index:2}
    .btn{margin-top:14px;font-size:16px;font-weight:800;border:none;border-radius:999px;cursor:pointer;
      padding:12px 26px;background:linear-gradient(180deg,var(--purple) 0%, var(--pink) 100%);color:#fff}
    .note{margin-top:8px;font-size:13px;color:#5e5e5e;text-align:center;line-height:1.4}
  </style>
</head>
<body>
  <div class="card">
    <div class="canvas-wrap">
      <canvas id="wheelCanvas" width="320" height="320"></canvas>
      <div class="hub"></div>
      <div class="needle" id="needle"></div>
    </div>
    <button id="spinBtn" class="btn">Start / ÈñãÂßã</button>
    <div id="note" class="note"></div>
  </div>

  <script>
    // Telegram ÂàùÂßãÂåñ
    if(window.Telegram && Telegram.WebApp){Telegram.WebApp.expand();Telegram.WebApp.ready();}

    const prizes=[
      {text:'1 üò¢ sorry',color:'#B7C9F2'},
      {text:'2 ‚è∞45 or 60‚è∞ /10 off',color:'#FFADAD'},
      {text:'3 üò¢ sorry',color:'#A9E4B0'},
      {text:'4 ‚è∞45 or 60‚è∞ /40 off',color:'#FFF2A8'},
      {text:'5 üò¢ sorry',color:'#DDBDFE'},
      {text:'6 ‚è∞45 or 60‚è∞ /10 off',color:'#A4B6FF'},
      {text:'7 ‚è∞45 or 60‚è∞ /20 off',color:'#FFC4D6'},
      {text:'8 üò¢ sorry',color:'#A9E4B0'}
    ];

    const wheel=document.getElementById('wheelCanvas');
    const ctx=wheel.getContext('2d');
    const radius=150;
    const segAngle=2*Math.PI/prizes.length;

    function drawWheel(){
      const cx=wheel.width/2,cy=wheel.height/2;
      ctx.clearRect(0,0,wheel.width,wheel.height);
      ctx.save();ctx.translate(cx,cy);
      prizes.forEach((p,i)=>{
        const start=i*segAngle,end=start+segAngle;
        ctx.beginPath();ctx.moveTo(0,0);
        ctx.arc(0,0,radius,start,end);
        ctx.closePath();
        ctx.fillStyle=p.color;ctx.fill();
        ctx.save();
        ctx.rotate(start+segAngle/2);
        ctx.textAlign='right';ctx.fillStyle='#222';ctx.font='16px Arial';
        ctx.fillText(p.text,radius-10,5);
        ctx.restore();
      });
      ctx.restore();
    }
    drawWheel();

    const needle=document.getElementById('needle');
    const spinBtn=document.getElementById('spinBtn');
    const note=document.getElementById('note');

    const WEEK_MS=7*24*60*60*1000;
    const lastSpin=localStorage.getItem('lastSpinTime');
    if(lastSpin){
      const diff=Date.now()-parseInt(lastSpin);
      if(diff<WEEK_MS){
        const remain=Math.ceil((WEEK_MS-diff)/(24*60*60*1000));
        spinBtn.disabled=true;
        spinBtn.textContent='Done / ÂÆåÊàê';
        note.textContent=`üïí ÊÇ®Â∑≤ÊäΩÈÅéÔºåË´ãÂú® ${remain} Â§©ÂæåÂÜçÊ¨°ÂèÉÂä† üéÅ\nüïí You already joined. Please try again in ${remain} day(s) üéÅ`;
      }
    }

    spinBtn.addEventListener('click',()=>{
      const spins=8;
      const target=Math.floor(Math.random()*prizes.length);
      const anglePer=360/prizes.length;
      const finalAngle=spins*360 + target*anglePer + (Math.random()*anglePer/2);
      needle.style.transform=`translateX(-50%) rotate(${finalAngle}deg)`;
      spinBtn.disabled=true;spinBtn.textContent='Spinning... / ÊóãËΩâ‰∏≠...';
      setTimeout(()=>{
        const result=prizes[target].text;
        alert(`üéâ ÊÅ≠Âñú‰∏≠ÁçéÔºÅ / üéâ Congratulations!\n${result}`);
        spinBtn.textContent='Done / ÂÆåÊàê';
        localStorage.setItem('lastSpinTime',Date.now().toString());
        if(window.Telegram && Telegram.WebApp){
          const payload={result,zh:'ÊÅ≠Âñú‰∏≠ÁçéÔºö'+result,en:'Congratulations! You got '+result,ts:Date.now()};
          Telegram.WebApp.sendData(JSON.stringify(payload));
        }
      },5000);
    });
  </script>
</body>
</html>
